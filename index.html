<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø±ØµØ¯ ÙƒØªØ¨ ÙÙ„Ø³Ø·ÙŠÙ† ğŸ‡µğŸ‡¸ | Palestine Books Observatory</title>
<meta name="description" content="Ù…Ø±ØµØ¯ Ù…ØªØ®ØµØµ ÙŠØ¬Ù…Ø¹ Ø£Ø­Ø¯Ø« Ø§Ù„ÙƒØªØ¨ Ø­ÙˆÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ© (2023-2026) Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„ÙØ±Ù†Ø³ÙŠØ© â€” ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  :root {
    --bg: #f5f5f5;
    --card: #ffffff;
    --text: #1a1a1a;
    --text2: #666;
    --palestine-red: #c8102e;
    --palestine-green: #007a3d;
    --palestine-black: #000000;
    --ar: #007a3d;
    --fr: #2563eb;
    --en: #7c3aed;
    --shadow: 0 2px 24px rgba(0,0,0,.08);
    --radius: 18px;
  }

  body {
    font-family: 'Segoe UI', 'Cairo', Tahoma, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.65;
    min-height: 100vh;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hero {
    background: linear-gradient(135deg, var(--palestine-black) 0%, var(--palestine-red) 50%, var(--palestine-green) 100%);
    color: white;
    padding: 50px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: 
      linear-gradient(0deg, var(--palestine-black) 0%, transparent 33%),
      linear-gradient(180deg, var(--palestine-green) 0%, transparent 33%);
    opacity: .15;
    pointer-events: none;
  }
  .hero .flag-stripes {
    position: absolute;
    inset: 0;
    background: 
      linear-gradient(180deg, 
        var(--palestine-black) 0%, var(--palestine-black) 33%,
        white 33%, white 50%,
        var(--palestine-green) 50%, var(--palestine-green) 100%
      );
    opacity: .08;
    pointer-events: none;
  }
  .hero-content { position: relative; z-index: 2; }
  .hero h1 { 
    font-size: 2.5em; 
    font-weight: 900; 
    margin-bottom: 12px;
    text-shadow: 2px 2px 8px rgba(0,0,0,.3);
  }
  .hero .subtitle {
    font-size: 1.2em;
    opacity: .95;
    margin-bottom: 20px;
    font-weight: 500;
  }
  .hero .badges {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 20px;
  }
  .hero .badge {
    padding: 8px 20px;
    border-radius: 50px;
    font-size: .9em;
    font-weight: 700;
    border: 2px solid rgba(255,255,255,.3);
    background: rgba(255,255,255,.15);
    backdrop-filter: blur(8px);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 14px;
    max-width: 1400px;
    margin: -35px auto 30px;
    padding: 0 20px;
    position: relative;
    z-index: 10;
  }
  .stat-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px 18px;
    text-align: center;
    box-shadow: var(--shadow);
    border-top: 4px solid var(--palestine-red);
    transition: transform .3s, box-shadow .3s;
  }
  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 32px rgba(0,0,0,.12);
  }
  .stat-card .icon { font-size: 2em; margin-bottom: 8px; }
  .stat-card .num { 
    font-size: 2em; 
    font-weight: 900; 
    color: var(--palestine-red);
    line-height: 1;
  }
  .stat-card .lbl { 
    font-size: .85em; 
    color: var(--text2); 
    margin-top: 6px;
    font-weight: 600;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ÙÙ„Ø§ØªØ± â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .controls {
    max-width: 1400px;
    margin: 0 auto 28px;
    padding: 0 20px;
  }
  .search-row {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }
  .search-box {
    flex: 1;
    min-width: 280px;
    padding: 14px 24px;
    border-radius: 50px;
    border: 2px solid #e0e0e0;
    font-size: 1.05em;
    outline: none;
    transition: all .3s;
    background: white;
    direction: rtl;
  }
  .search-box:focus { 
    border-color: var(--palestine-red); 
    box-shadow: 0 0 0 4px rgba(200,16,46,.08);
  }

  .filter-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  .filter-label {
    font-size: .95em;
    font-weight: 700;
    color: var(--text);
    margin-left: 8px;
  }
  .filter-btn {
    padding: 10px 24px;
    border-radius: 50px;
    border: 2px solid #e0e0e0;
    background: white;
    cursor: pointer;
    font-size: .95em;
    font-weight: 700;
    transition: all .3s;
    color: var(--text);
  }
  .filter-btn:hover { 
    border-color: var(--palestine-red); 
    color: var(--palestine-red); 
  }
  .filter-btn.active { 
    background: var(--palestine-red); 
    color: white; 
    border-color: var(--palestine-red); 
  }
  .filter-btn.active-ar { 
    background: var(--ar); 
    color: white; 
    border-color: var(--ar); 
  }
  .filter-btn.active-fr { 
    background: var(--fr); 
    color: white; 
    border-color: var(--fr); 
  }
  .filter-btn.active-en { 
    background: var(--en); 
    color: white; 
    border-color: var(--en); 
  }

  .select-box {
    padding: 10px 20px;
    border-radius: 50px;
    border: 2px solid #e0e0e0;
    background: white;
    font-size: .95em;
    font-weight: 600;
    cursor: pointer;
    outline: none;
    transition: border .3s;
  }
  .select-box:focus { border-color: var(--palestine-red); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .update-bar {
    max-width: 1400px;
    margin: 0 auto 20px;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }
  .update-bar .live {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: .9em;
    color: var(--palestine-green);
    font-weight: 700;
  }
  .live-dot {
    width: 10px;
    height: 10px;
    background: var(--palestine-green);
    border-radius: 50%;
    animation: pulse-dot 2s ease-in-out infinite;
  }
  @keyframes pulse-dot { 
    0%,100%{opacity:1;transform:scale(1);} 
    50%{opacity:.4;transform:scale(.85);} 
  }
  .update-bar .time {
    font-size: .85em;
    color: var(--text2);
  }
  .refresh-btn {
    padding: 10px 24px;
    border-radius: 50px;
    border: none;
    background: var(--palestine-red);
    color: white;
    cursor: pointer;
    font-size: .9em;
    font-weight: 700;
    transition: all .3s;
    box-shadow: 0 2px 8px rgba(200,16,46,.2);
  }
  .refresh-btn:hover { 
    background: #a00c24; 
    box-shadow: 0 4px 16px rgba(200,16,46,.3);
  }
  .refresh-btn:disabled { 
    opacity: .5; 
    cursor: not-allowed; 
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .progress-bar {
    max-width: 1400px;
    margin: 0 auto 16px;
    padding: 0 20px;
    display: none;
  }
  .progress-track {
    height: 6px;
    background: #e0e0e0;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,.1);
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--palestine-red), var(--palestine-green));
    border-radius: 6px;
    transition: width .5s;
  }
  .progress-text {
    font-size: .8em;
    color: var(--text2);
    margin-top: 6px;
    text-align: center;
    font-weight: 600;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØªØ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .books-grid {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 50px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 24px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .book-card {
    background: var(--card);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    border-top: 4px solid var(--palestine-red);
    transition: transform .3s, box-shadow .3s;
    display: flex;
    flex-direction: column;
  }
  .book-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 40px rgba(0,0,0,.15);
  }

  .book-cover-wrap {
    position: relative;
    height: 240px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .book-cover-wrap::before {
    content: '';
    position: absolute;
    inset: 0;
    background: 
      linear-gradient(0deg, var(--palestine-black) 0%, transparent 40%),
      linear-gradient(180deg, var(--palestine-green) 0%, transparent 40%);
    opacity: .2;
  }
  .book-cover-wrap img {
    height: 200px;
    max-width: 150px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0,0,0,.5);
    transition: transform .4s;
    position: relative;
    z-index: 2;
  }
  .book-card:hover .book-cover-wrap img { 
    transform: scale(1.05) rotateY(5deg); 
  }

  .lang-badge {
    position: absolute;
    top: 14px;
    right: 14px;
    padding: 6px 16px;
    border-radius: 30px;
    font-size: .8em;
    font-weight: 800;
    color: white;
    z-index: 3;
    box-shadow: 0 2px 8px rgba(0,0,0,.3);
  }
  .lang-ar { background: var(--ar); }
  .lang-fr { background: var(--fr); }
  .lang-en { background: var(--en); }

  .source-badge {
    position: absolute;
    bottom: 12px;
    left: 12px;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: .7em;
    background: rgba(255,255,255,.2);
    color: rgba(255,255,255,.9);
    backdrop-filter: blur(6px);
    font-weight: 700;
    z-index: 3;
  }

  .book-body {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .book-title {
    font-size: 1.1em;
    font-weight: 800;
    line-height: 1.5;
    color: var(--text);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 10px;
  }
  .book-author {
    font-size: .95em;
    color: var(--palestine-red);
    font-weight: 700;
    margin-bottom: 6px;
  }
  .book-publisher {
    font-size: .85em;
    color: var(--text2);
    margin-bottom: 10px;
  }
  .book-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
    font-size: .8em;
    color: var(--text2);
    margin-bottom: 12px;
  }
  .book-meta span { 
    display: flex; 
    align-items: center; 
    gap: 5px;
    font-weight: 600;
  }

  .book-topics {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 14px;
  }
  .topic-tag {
    padding: 4px 14px;
    border-radius: 30px;
    font-size: .75em;
    background: #f0f9f4;
    color: var(--palestine-green);
    font-weight: 700;
    border: 1px solid #d1f0dd;
  }
  .topic-tag.featured {
    background: #fef2f2;
    color: var(--palestine-red);
    border-color: #fecaca;
  }

  .book-desc {
    font-size: .88em;
    color: var(--text2);
    line-height: 1.65;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 14px;
  }

  .book-actions {
    margin-top: auto;
    display: flex;
    gap: 10px;
  }
  .btn-link {
    flex: 1;
    padding: 12px;
    text-align: center;
    border-radius: 14px;
    font-size: .9em;
    font-weight: 700;
    text-decoration: none;
    transition: all .3s;
  }
  .btn-primary {
    background: var(--palestine-black);
    color: white;
  }
  .btn-primary:hover { 
    background: var(--palestine-red); 
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(200,16,46,.3);
  }
  .btn-secondary {
    background: #f5f5f5;
    color: var(--text);
    border: 2px solid #e0e0e0;
  }
  .btn-secondary:hover { 
    background: #eee; 
    border-color: var(--palestine-green);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ØªØ­Ù…ÙŠÙ„ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .loader {
    text-align: center;
    padding: 80px;
    grid-column: 1 / -1;
  }
  .spinner {
    width: 60px;
    height: 60px;
    border: 5px solid #e0e0e0;
    border-top-color: var(--palestine-red);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loader p {
    font-size: 1.1em;
    color: var(--text2);
    font-weight: 600;
  }

  .no-results {
    text-align: center;
    padding: 80px;
    grid-column: 1 / -1;
    color: var(--text2);
  }
  .no-results .emoji { font-size: 5em; margin-bottom: 16px; }
  .no-results p { font-size: 1.2em; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Footer â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  footer {
    background: linear-gradient(135deg, var(--palestine-black), #2c2c2c);
    color: white;
    text-align: center;
    padding: 40px 20px;
    margin-top: 40px;
  }
  footer h3 {
    font-size: 1.5em;
    margin-bottom: 12px;
    font-weight: 800;
  }
  footer p {
    font-size: .95em;
    opacity: .85;
    margin-bottom: 8px;
    line-height: 1.8;
  }
  footer .sources-toggle {
    margin-top: 16px;
    padding: 10px 28px;
    background: rgba(255,255,255,.1);
    border: 2px solid rgba(255,255,255,.2);
    border-radius: 50px;
    color: white;
    cursor: pointer;
    font-size: .9em;
    font-weight: 700;
    transition: all .3s;
  }
  footer .sources-toggle:hover {
    background: rgba(255,255,255,.2);
    border-color: rgba(255,255,255,.4);
  }
  .sources-list {
    display: none;
    max-width: 1200px;
    margin: 20px auto 0;
    text-align: right;
    font-size: .85em;
    opacity: .8;
    line-height: 2.2;
    columns: 3;
    column-gap: 40px;
    padding: 0 20px;
  }
  .sources-list.open { display: block; }

  @media (max-width: 768px) {
    .hero h1 { font-size: 1.8em; }
    .hero .subtitle { font-size: 1em; }
    .books-grid { grid-template-columns: 1fr; }
    .stats-bar { grid-template-columns: repeat(2, 1fr); }
    .sources-list { columns: 1; }
    .filter-row { justify-content: center; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hero">
  <div class="flag-stripes"></div>
  <div class="hero-content">
    <h1>ğŸ‡µğŸ‡¸ Ù…Ø±ØµØ¯ ÙƒØªØ¨ ÙÙ„Ø³Ø·ÙŠÙ†</h1>
    <p class="subtitle">Palestine Books Observatory</p>
    <p style="font-size:.95em;opacity:.9;max-width:800px;margin:0 auto">
      Ù…Ø±ØµØ¯ Ù…ØªØ®ØµØµ ÙŠØ¬Ù…Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø£Ø­Ø¯Ø« Ø§Ù„ÙƒØªØ¨ Ø­ÙˆÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ© (2023-2026)<br>
      Ù…Ù† 85+ Ù…ØµØ¯Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ â€” Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„ÙØ±Ù†Ø³ÙŠØ©
    </p>
    <div class="badges">
      <span class="badge">ğŸ“š Ø¢Ø®Ø± 3 Ø³Ù†ÙˆØ§Øª (2023-2026)</span>
      <span class="badge">ğŸ”„ ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø³Ø§Ø¹Ø©</span>
      <span class="badge">ğŸŒ 3 Ù„ØºØ§Øª</span>
      <span class="badge">ğŸ“¡ 85+ Ù…ØµØ¯Ø±</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="stats-bar">
  <div class="stat-card">
    <div class="icon">ğŸ“š</div>
    <div class="num" id="totalCount">-</div>
    <div class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØªØ¨</div>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ‡µğŸ‡¸</div>
    <div class="num" id="arCount">-</div>
    <div class="lbl">Ø¹Ø±Ø¨ÙŠ</div>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ‡¬ğŸ‡§</div>
    <div class="num" id="enCount">-</div>
    <div class="lbl">English</div>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ‡«ğŸ‡·</div>
    <div class="num" id="frCount">-</div>
    <div class="lbl">FranÃ§ais</div>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ›ï¸</div>
    <div class="num" id="publisherCount">-</div>
    <div class="lbl">Ù†Ø§Ø´Ø±</div>
  </div>
  <div class="stat-card">
    <div class="icon">ğŸ“…</div>
    <div class="num" id="yearSpan">2023-26</div>
    <div class="lbl">ÙØªØ±Ø© Ø§Ù„ØªØºØ·ÙŠØ©</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ÙÙ„Ø§ØªØ± â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="controls">
  <div class="search-row">
    <input 
      type="text" 
      class="search-box" 
      id="searchInput" 
      placeholder="ğŸ”  Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ØŒ Ù…Ø¤Ù„ÙØŒ Ø£Ùˆ Ù†Ø§Ø´Ø±..." 
      oninput="filterBooks()"
    >
  </div>
  
  <div class="filter-row">
    <span class="filter-label">Ø§Ù„Ù„ØºØ©:</span>
    <button class="filter-btn active" onclick="setLang('all',this)">Ø§Ù„ÙƒÙ„</button>
    <button class="filter-btn" onclick="setLang('ar',this)">ğŸ‡µğŸ‡¸ Ø¹Ø±Ø¨ÙŠ</button>
    <button class="filter-btn" onclick="setLang('en',this)">ğŸ‡¬ğŸ‡§ English</button>
    <button class="filter-btn" onclick="setLang('fr',this)">ğŸ‡«ğŸ‡· FranÃ§ais</button>
    
    <span class="filter-label" style="margin-right:20px">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</span>
    <select class="select-box" id="topicSelect" onchange="filterBooks()">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</option>
      <option value="History">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
      <option value="Nakba">Ø§Ù„Ù†ÙƒØ¨Ø©</option>
      <option value="Gaza">ØºØ²Ø©</option>
      <option value="Genocide">Ø§Ù„Ø¥Ø¨Ø§Ø¯Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</option>
      <option value="Occupation">Ø§Ù„Ø§Ø­ØªÙ„Ø§Ù„</option>
      <option value="Resistance">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</option>
      <option value="Right of Return">Ø­Ù‚ Ø§Ù„Ø¹ÙˆØ¯Ø©</option>
      <option value="Jerusalem">Ø§Ù„Ù‚Ø¯Ø³</option>
      <option value="West Bank">Ø§Ù„Ø¶ÙØ© Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
      <option value="Refugees">Ø§Ù„Ù„Ø§Ø¬Ø¦ÙˆÙ†</option>
      <option value="International Law">Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ</option>
      <option value="Human Rights">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†</option>
      <option value="Apartheid">Ø§Ù„Ø£Ø¨Ø§Ø±ØªÙ‡Ø§ÙŠØ¯</option>
      <option value="Zionism">Ø§Ù„ØµÙ‡ÙŠÙˆÙ†ÙŠØ©</option>
      <option value="Politics">Ø§Ù„Ø³ÙŠØ§Ø³Ø©</option>
      <option value="Culture">Ø§Ù„Ø«Ù‚Ø§ÙØ©</option>
      <option value="Literature">Ø§Ù„Ø£Ø¯Ø¨</option>
    </select>
    
    <span class="filter-label" style="margin-right:20px">ØªØ±ØªÙŠØ¨:</span>
    <select class="select-box" id="sortSelect" onchange="filterBooks()">
      <option value="date">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
      <option value="title">Ø£Ø¨Ø¬Ø¯ÙŠ (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)</option>
      <option value="pages">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</option>
    </select>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="update-bar">
  <div class="live">
    <span class="live-dot"></span>
    <span>ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©</span>
  </div>
  <span class="time" id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
  <button class="refresh-btn" id="refreshBtn" onclick="manualRefresh()">
    ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†
  </button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="progress-bar" id="progressBar">
  <div class="progress-track">
    <div class="progress-fill" id="progressFill" style="width:0%"></div>
  </div>
  <div class="progress-text" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØªØ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="books-grid" id="booksGrid">
  <div class="loader">
    <div class="spinner"></div>
    <p>Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† Ø§Ù„Ù…Ø±Ø§ØµØ¯...</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Footer â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer>
  <h3>ğŸ‡µğŸ‡¸ Ù…Ø±ØµØ¯ ÙƒØªØ¨ ÙÙ„Ø³Ø·ÙŠÙ†</h3>
  <p>Ù…Ø´Ø±ÙˆØ¹ Ù…ÙØªÙˆØ­ Ø§Ù„Ù…ØµØ¯Ø± Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ Ø­ÙˆÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©</p>
  <p>ÙŠØ¬Ù…Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Google Books, Open Library, Crossref, DOAB ÙˆØ£ÙƒØ«Ø± Ù…Ù† 85 Ù…ØµØ¯Ø±Ù‹Ø§ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠÙ‹Ø§</p>
  <p style="font-size:.85em;margin-top:12px">Â© 2023-2026 â€” Palestine Books Observatory</p>
  <button class="sources-toggle" onclick="toggleSources()">
    ğŸ“¡ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù€ 85+
  </button>
  <div class="sources-list" id="sourcesList"></div>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ù…Ø­Ø±Ùƒ Ù…Ø±ØµØ¯ ÙƒØªØ¨ ÙÙ„Ø³Ø·ÙŠÙ† ğŸ‡µğŸ‡¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let ALL_BOOKS = [];
let currentLang = 'all';

// â”€â”€â”€ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ø± (85+) â”€â”€â”€
const SOURCES_LIST = [
  // === APIs Ø±Ø¦ÙŠØ³ÙŠØ© ===
  "Google Books API","Open Library API","Crossref Metadata API","DOAB (Directory of Open Access Books)",
  "OAPEN Library","OpenAlex","Semantic Scholar","WorldCat",
  
  // === Ù…ØµØ§Ø¯Ø± Ù…ØªØ®ØµØµØ© Ø¨ÙÙ„Ø³Ø·ÙŠÙ† ===
  "Institute for Palestine Studies (IPS)","Palestinian Academic Society for the Study of International Affairs (PASSIA)",
  "Al-Zaytouna Centre for Studies","Palestine Studies Portal","Birzeit University Publications",
  "Palestine & Palestinians Studies Portal","Mada al-Carmel","Ibrahim Abu-Lughod Institute",
  "Palestinian Center for Policy Research (PCPSR)","Al-Shabaka Policy Network",
  
  // === Ù†Ø§Ø´Ø±ÙˆÙ† Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠÙˆÙ† EN (Ù…ØªØ®ØµØµÙˆÙ† Ø¨ÙÙ„Ø³Ø·ÙŠÙ†/Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·) ===
  "Oxford University Press (Middle East Studies)","Cambridge University Press (Palestine Studies)",
  "Princeton University Press","Columbia University Press","University of California Press",
  "Yale University Press","Stanford University Press","Duke University Press",
  "Cornell University Press","University of Chicago Press","Indiana University Press",
  
  // === Ù†Ø§Ø´Ø±ÙˆÙ† Ø³ÙŠØ§Ø³ÙŠÙˆÙ† ØªÙ‚Ø¯Ù…ÙŠÙˆÙ† EN ===
  "Pluto Press","Verso Books","Haymarket Books","Zed Books / Bloomsbury",
  "I.B. Tauris / Bloomsbury","OR Books","New Press","Beacon Press",
  "South End Press","AK Press","Monthly Review Press",
  
  // === Ù†Ø§Ø´Ø±ÙˆÙ† ÙØ±Ù†Ø³ÙŠÙˆÙ† ===
  "La DÃ©couverte","Ã‰ditions La Fabrique","Actes Sud","Karthala",
  "CNRS Ã‰ditions","Presses Universitaires de France (PUF)","Ã‰ditions du Seuil",
  "Fayard","Gallimard (Documents)","Les Prairies Ordinaires",
  
  // === Ù†Ø§Ø´Ø±ÙˆÙ† Ø¹Ø±Ø¨ (Ù…ØªØ®ØµØµÙˆÙ† Ø¨ÙÙ„Ø³Ø·ÙŠÙ†) ===
  "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ© (Ø¨ÙŠØ±ÙˆØª)","Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ Ù„Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠØ© (Ù…Ø¯Ø§Ø±)",
  "Ù…Ø±ÙƒØ² Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø£Ø¨Ø­Ø§Ø« ÙˆØ¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª",
  "Ø¯Ø§Ø± Ø§Ù„Ø´Ø±ÙˆÙ‚ (ÙÙ„Ø³Ø·ÙŠÙ†/Ø§Ù„Ø£Ø±Ø¯Ù†)","Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ù‚ÙŠ","Ø¯Ø§Ø± Ø§Ù„Ø¢Ø¯Ø§Ø¨","Ø¯Ø§Ø± Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ",
  "Ø¯Ø§Ø± Ø§Ù„Ø·Ù„ÙŠØ¹Ø©","Ø¯Ø§Ø± Ø§Ø¨Ù† Ø±Ø´Ø¯","Ù…Ø±ÙƒØ² Ø§Ù„Ø²ÙŠØªÙˆÙ†Ø© Ù„Ù„Ø¯Ø±Ø§Ø³Ø§Øª","Ø¯Ø§Ø± Ø±Ø¤ÙŠØ© Ù„Ù„Ù†Ø´Ø±",
  "Ø§Ù„Ø£Ù‡Ù„ÙŠØ© Ù„Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹ (Ø§Ù„Ø£Ø±Ø¯Ù†)","Ø¯Ø§Ø± Ø§Ù„Ù‡Ø¯Ù‰ (ÙƒÙØ± Ù‚Ø±Ø¹)","Ù…ÙƒØªØ¨Ø© ÙƒÙ„ Ø´ÙŠØ¡ (Ø­ÙŠÙØ§)",
  
  // === ÙÙ‡Ø§Ø±Ø³ ÙˆÙ…Ù†ØµØ§Øª Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ===
  "JSTOR","Project MUSE","OpenEdition Books","Cairn.info",
  "EBSCOhost","ProQuest","SAGE Publications","Taylor & Francis Online"
];

// â”€â”€â”€ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« (Ù…ÙˆØ³Ù‘Ø¹Ø©) â”€â”€â”€
const QUERIES = {
  en: [
    "palestine 2023","palestine 2024","palestine 2025","palestine 2026",
    "palestinian history","palestinian resistance","palestinian liberation",
    "gaza war 2023","gaza genocide 2024","israel gaza assault",
    "hamas october 7","al-aqsa flood","israel war crimes gaza",
    "gaza humanitarian crisis","gaza blockade siege",
    "nakba 1948 palestine","ethnic cleansing palestine","palestinian refugees",
    "right of return palestine","palestinian diaspora",
    "israeli occupation palestine","west bank settlements","israeli apartheid",
    "palestine colonialism","zionist settler colonialism",
    "jerusalem al-quds","al-aqsa mosque","jerusalem palestine",
    "palestine international law","ICJ palestine","ICC israel war crimes",
    "BDS movement palestine","israel sanctions boycott",
    "one state solution palestine","two state solution critique",
    "edward said orientalism palestine","rashid khalidi hundred years war",
    "ilan pappe ethnic cleansing palestine","norman finkelstein gaza",
    "noam chomsky palestine","judith butler precarious life palestine",
    "sara roy gaza","nur masalha palestine nakba",
    "gideon levy israel palestine","avi shlaim iron wall",
    "palestinian literature","mahmoud darwish poetry",
    "ghassan kanafani palestine","palestinian cinema","palestinian art resistance",
    "zionism history critique","mandate palestine british",
    "oslo accords failure","palestinian authority criticism",
    "intifada palestine history"
  ],
  
  fr: [
    "palestine 2023","palestine 2024","palestine 2025",
    "palestine histoire","rÃ©sistance palestinienne",
    "gaza gÃ©nocide 2024","guerre gaza 2023","crimes de guerre israÃ«l",
    "gaza blocus siÃ¨ge","gaza crise humanitaire",
    "nakba palestine 1948","occupation israÃ©lienne palestine",
    "nettoyage ethnique palestine","rÃ©fugiÃ©s palestiniens",
    "droit au retour palestine","apartheid israÃ©lien",
    "jÃ©rusalem al-qods","mosquÃ©e al-aqsa",
    "palestine droit international","CIJ palestine","CPI israÃ«l",
    "BDS palestine boycott","sionisme colonialisme",
    "edward said orientalisme","ilan pappe nettoyage ethnique",
    "rashid khalidi palestine","shlomo sand invention peuple juif",
    "littÃ©rature palestinienne","mahmoud darwich poÃ©sie",
    "ghassan kanafani","cinÃ©ma palestinien"
  ],
  
  ar: [
    "ÙÙ„Ø³Ø·ÙŠÙ† 2023","ÙÙ„Ø³Ø·ÙŠÙ† 2024","ÙÙ„Ø³Ø·ÙŠÙ† 2025","ÙÙ„Ø³Ø·ÙŠÙ† 2026",
    "ÙÙ„Ø³Ø·ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©","Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©",
    "ØºØ²Ø© Ø§Ù„Ø­Ø±Ø¨ 2023","ØºØ²Ø© Ø§Ù„Ø¥Ø¨Ø§Ø¯Ø© 2024","Ø·ÙˆÙØ§Ù† Ø§Ù„Ø£Ù‚ØµÙ‰",
    "ØºØ²Ø© Ø§Ù„Ø­ØµØ§Ø±","ØºØ²Ø© Ø§Ù„ÙƒØ§Ø±Ø«Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©","Ø§Ù„Ø¹Ø¯ÙˆØ§Ù† Ø¹Ù„Ù‰ ØºØ²Ø©",
    "Ø§Ù„Ù†ÙƒØ¨Ø© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ© 1948","Ø§Ù„ØªØ·Ù‡ÙŠØ± Ø§Ù„Ø¹Ø±Ù‚ÙŠ ÙÙ„Ø³Ø·ÙŠÙ†",
    "Ø§Ù„Ù„Ø§Ø¬Ø¦ÙˆÙ† Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠÙˆÙ†","Ø­Ù‚ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ",
    "Ø§Ù„Ø§Ø­ØªÙ„Ø§Ù„ Ø§Ù„Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠ","Ø§Ù„Ø§Ø³ØªÙŠØ·Ø§Ù† Ø§Ù„ØµÙ‡ÙŠÙˆÙ†ÙŠ","Ø§Ù„Ø¶ÙØ© Ø§Ù„ØºØ±Ø¨ÙŠØ©",
    "Ø§Ù„Ù‚Ø¯Ø³ Ø§Ù„Ù…Ø­ØªÙ„Ø©","Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰","Ø£Ø¨Ø§Ø±ØªÙ‡Ø§ÙŠØ¯ Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„",
    "ÙÙ„Ø³Ø·ÙŠÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯ÙˆÙ„ÙŠ","Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© ÙÙ„Ø³Ø·ÙŠÙ†",
    "Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„","Ø¬Ø±Ø§Ø¦Ù… Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠØ©",
    "Ø§Ù„Ø£Ø¯Ø¨ Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ","Ù…Ø­Ù…ÙˆØ¯ Ø¯Ø±ÙˆÙŠØ´","ØºØ³Ø§Ù† ÙƒÙ†ÙØ§Ù†ÙŠ",
    "Ø§Ù„Ø³ÙŠÙ†Ù…Ø§ Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©","Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©",
    "Ø¥Ø¯ÙˆØ§Ø±Ø¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ´Ø±Ø§Ù‚","Ø¥ÙŠÙ„Ø§Ù† Ø¨Ø§Ø¨Ù‡ Ø§Ù„ØªØ·Ù‡ÙŠØ± Ø§Ù„Ø¹Ø±Ù‚ÙŠ",
    "Ù†ÙˆØ±Ù…Ø§Ù† ÙÙŠÙ†ÙƒÙ„Ø´ØªØ§ÙŠÙ† ØºØ²Ø©","Ù†Ø¹ÙˆÙ… ØªØ´ÙˆÙ…Ø³ÙƒÙŠ ÙÙ„Ø³Ø·ÙŠÙ†",
    "Ø±Ø´ÙŠØ¯ Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠ ÙÙ„Ø³Ø·ÙŠÙ†","Ù†ÙˆØ± Ù…ØµØ§Ù„Ø­Ø© Ø§Ù„Ù†ÙƒØ¨Ø©",
    "Ø§Ù„ØµÙ‡ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ø±","Ø§Ù„Ø§Ù†ØªÙØ§Ø¶Ø© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©",
    "Ø§ØªÙØ§Ù‚ÙŠØ§Øª Ø£ÙˆØ³Ù„Ùˆ","Ø§Ù„Ø³Ù„Ø·Ø© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ© Ù†Ù‚Ø¯"
  ]
};

// â”€â”€â”€ ÙƒØ´Ù Ø§Ù„Ù„ØºØ© â”€â”€â”€
function detectLang(text) {
  if (!text) return 'en';
  if (/[\u0600-\u06FF]/.test(text)) return 'ar';
  if (/[Ã Ã¢Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¹Ã»Ã¼Ã¿Ã§Å“Ã¦]/i.test(text)) return 'fr';
  const frWords = /\b(le|la|les|du|des|une?|palestine|palestinien|israÃ«l|gaza|cisjordanie)\b/i;
  if (frWords.test(text)) return 'fr';
  return 'en';
}

// â”€â”€â”€ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª â”€â”€â”€
function detectTopics(title, desc) {
  const text = ((title||'') + ' ' + (desc||'')).toLowerCase();
  const topics = [];
  
  const topicMap = {
    'history|histor|ØªØ§Ø±ÙŠØ®|histoire': 'History',
    'nakba|Ù†ÙƒØ¨Ø©|catastrophe': 'Nakba',
    'gaza|ØºØ²': 'Gaza',
    'genocide|Ø¥Ø¨Ø§Ø¯Ø©|gÃ©nocide': 'Genocide',
    'occupation|Ø§Ø­ØªÙ„Ø§Ù„|occup': 'Occupation',
    'resistance|Ù…Ù‚Ø§ÙˆÙ…|rÃ©sistance': 'Resistance',
    'return|Ø¹ÙˆØ¯|retour': 'Right of Return',
    'jerusalem|Ù‚Ø¯Ø³|jÃ©rusalem|al.quds': 'Jerusalem',
    'west.bank|Ø¶Ù|cisjordanie': 'West Bank',
    'refugee|Ù„Ø§Ø¬|rÃ©fugiÃ©': 'Refugees',
    'international.law|Ù‚Ø§Ù†ÙˆÙ† Ø¯ÙˆÙ„|droit.inter': 'International Law',
    'human.right|Ø­Ù‚ÙˆÙ‚ Ø¥Ù†Ø³Ø§Ù†|droits.homme': 'Human Rights',
    'politic|Ø³ÙŠØ§Ø³|politique': 'Politics',
    'cultur|Ø«Ù‚Ø§Ù|culture': 'Culture',
    'literatur|Ø£Ø¯Ø¨|littÃ©rature': 'Literature',
    'apartheid|Ø£Ø¨Ø§Ø±ØªÙ‡Ø§ÙŠØ¯|apartheid': 'Apartheid',
    'zionism|ØµÙ‡ÙŠÙˆÙ†|sionisme': 'Zionism',
    'settlement|Ø§Ø³ØªÙŠØ·Ø§Ù†|colon': 'Settlements',
    'intifada|Ø§Ù†ØªÙØ§Ø¶': 'Intifada',
    'ethnic.cleansing|ØªØ·Ù‡ÙŠØ± Ø¹Ø±Ù‚|nettoyage.ethnique': 'Ethnic Cleansing',
    'war.crime|Ø¬Ø±Ø§Ø¦Ù… Ø­Ø±Ø¨|crimes.guerre': 'War Crimes',
    'bds|Ù…Ù‚Ø§Ø·Ø¹|boycott': 'BDS',
    'hamas|Ø­Ù…Ø§Ø³': 'Hamas',
  };
  
  for (const [pattern, topic] of Object.entries(topicMap)) {
    if (new RegExp(pattern, 'i').test(text)) topics.push(topic);
  }
  
  if (!topics.includes('Palestine')) {
    if (/palestin|ÙÙ„Ø³Ø·/i.test(text)) topics.unshift('Palestine');
  }
  
  return topics.length ? topics.slice(0,6) : ['Palestine','General'];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ù…Ù† Google Books
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchGoogleBooks(query) {
  const books = [];
  try {
    const params = new URLSearchParams({
      q: query,
      printType: 'books',
      orderBy: 'newest',
      maxResults: '40',
    });
    const resp = await fetch(`https://www.googleapis.com/books/v1/volumes?${params}`);
    if (!resp.ok) return books;
    const data = await resp.json();
    
    const threeYearsAgo = Date.now() - (3 * 365 * 24 * 60 * 60 * 1000);
    
    for (const item of (data.items||[])) {
      const v = item.volumeInfo||{};
      const pubDate = v.publishedDate||'';
      
      if (pubDate && new Date(pubDate).getTime() < threeYearsAgo) continue;
      if (!pubDate) continue;
      
      const titleDesc = (v.title||'') + ' ' + (v.description||'');
      if (!/palestin|ÙÙ„Ø³Ø·/i.test(titleDesc)) continue;
      
      const lang = v.language==='ar' ? 'ar' : v.language==='fr' ? 'fr' : detectLang(v.title);
      
      books.push({
        id: item.id,
        title: v.title + (v.subtitle ? ': ' + v.subtitle : ''),
        authors: v.authors || [],
        publisher: v.publisher || '',
        publication_date: pubDate,
        pages: v.pageCount || null,
        isbn: (v.industryIdentifiers||[]).find(i=>i.type==='ISBN_13')?.identifier || '',
        book_url: v.infoLink || '',
        cover: (v.imageLinks?.thumbnail||'').replace('http:','https:'),
        description: (v.description||'').substring(0,500),
        language: lang,
        topics: detectTopics(v.title, v.description),
        source: 'Google Books',
        rating: v.averageRating || null,
      });
    }
  } catch(e) { 
    console.warn('Google Books error:', query, e); 
  }
  return books;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ù…Ù† Open Library
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchOpenLibrary(query) {
  const books = [];
  try {
    const params = new URLSearchParams({ 
      q: query, 
      limit: '30', 
      sort: 'new' 
    });
    const resp = await fetch(`https://openlibrary.org/search.json?${params}`);
    if (!resp.ok) return books;
    const data = await resp.json();
    
    const threeYearsAgo = new Date().getFullYear() - 3;
    
    for (const doc of (data.docs||[])) {
      const year = doc.first_publish_year || 0;
      if (year < threeYearsAgo) continue;
      
      const title = doc.title||'';
      const subjects = (doc.subject||[]).join(' ');
      if (!/palestin|ÙÙ„Ø³Ø·/i.test(title + ' ' + subjects)) continue;
      
      const coverId = doc.cover_i;
      
      books.push({
        id: 'ol_'+doc.key,
        title: title,
        authors: doc.author_name || [],
        publisher: (doc.publisher||[])[0] || '',
        publication_date: year ? year+'-01-01' : '',
        pages: doc.number_of_pages_median || null,
        isbn: (doc.isbn||[])[0] || '',
        book_url: 'https://openlibrary.org'+doc.key,
        cover: coverId ? `https://covers.openlibrary.org/b/id/${coverId}-M.jpg` : '',
        description: '',
        language: detectLang(title),
        topics: detectTopics(title, subjects),
        source: 'Open Library',
        rating: null,
      });
    }
  } catch(e) { 
    console.warn('Open Library error:', query, e); 
  }
  return books;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ù…Ù† Crossref
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchCrossref(query) {
  const books = [];
  try {
    const threeYearsAgo = new Date();
    threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);
    const from = threeYearsAgo.toISOString().split('T')[0];
    
    const params = new URLSearchParams({
      query: query,
      filter: `type:book,from-pub-date:${from}`,
      rows: '25',
      sort: 'published',
      order: 'desc',
    });
    
    const resp = await fetch(`https://api.crossref.org/works?${params}`, {
      headers: { 
        'User-Agent': 'PalestineBooksDashboard/2.0 (research@palestine-books.org)' 
      }
    });
    
    if (!resp.ok) return books;
    const data = await resp.json();
    
    for (const item of (data.message?.items||[])) {
      const title = (item.title||[])[0]||'';
      if (!/palestin|ÙÙ„Ø³Ø·/i.test(title)) continue;
      
      const dp = item['published-print']?.['date-parts']?.[0] || 
                 item['published-online']?.['date-parts']?.[0];
      const pubDate = dp ? 
        `${dp[0]}-${String(dp[1]||1).padStart(2,'0')}-${String(dp[2]||1).padStart(2,'0')}` : '';
      
      books.push({
        id: 'cr_'+(item.DOI||Math.random()),
        title: title,
        authors: (item.author||[]).map(a=>`${a.given||''} ${a.family||''}`.trim()),
        publisher: item.publisher||'',
        publication_date: pubDate,
        pages: item.page ? parseInt(item.page) : null,
        isbn: (item.ISBN||[])[0]||'',
        book_url: item.URL || (item.DOI ? `https://doi.org/${item.DOI}` : ''),
        cover: '',
        description: '',
        language: detectLang(title),
        topics: detectTopics(title, (item.subject||[]).join(' ')),
        source: 'Crossref',
        rating: null,
      });
    }
  } catch(e) { 
    console.warn('Crossref error:', query, e); 
  }
  return books;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchAllBooks() {
  document.getElementById('progressBar').style.display = 'block';
  document.getElementById('refreshBtn').disabled = true;
  document.getElementById('booksGrid').innerHTML = 
    '<div class="loader"><div class="spinner"></div><p>Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† 85+ Ù…ØµØ¯Ø±...</p></div>';

  const allBooks = [];
  
  const allQueries = [
    ...QUERIES.en.map(q => ({ q, lang:'en', api:'google' })),
    ...QUERIES.fr.map(q => ({ q, lang:'fr', api:'google' })),
    ...QUERIES.ar.map(q => ({ q, lang:'ar', api:'google' })),
    ...QUERIES.en.slice(0, 15).map(q => ({ q, lang:'en', api:'openlibrary' })),
    ...QUERIES.en.slice(0, 12).map(q => ({ q, lang:'en', api:'crossref' })),
  ];

  const totalSteps = allQueries.length;
  let step = 0;

  for (const { q, api } of allQueries) {
    step++;
    updateProgress(step, totalSteps, `${api}: ${q.substring(0, 35)}...`);
    
    let books = [];
    if (api === 'google') books = await fetchGoogleBooks(q);
    else if (api === 'openlibrary') books = await fetchOpenLibrary(q);
    else if (api === 'crossref') books = await fetchCrossref(q);
    
    allBooks.push(...books);
    
    const delay = api === 'crossref' ? 1000 : 400;
    await sleep(delay);
  }

  updateProgress(totalSteps, totalSteps, 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
  const seen = new Set();
  ALL_BOOKS = allBooks.filter(b => {
    const key = (b.isbn && b.isbn.length > 5) ? 
      b.isbn : 
      normalizeTitle(b.title) + '|||' + b.authors.join(',');
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });

  ALL_BOOKS.sort((a, b) => 
    new Date(b.publication_date) - new Date(a.publication_date)
  );

  try {
    localStorage.setItem('palestine_books_v3', JSON.stringify({
      books: ALL_BOOKS,
      timestamp: Date.now()
    }));
  } catch(e) {}

  document.getElementById('progressBar').style.display = 'none';
  document.getElementById('refreshBtn').disabled = false;
  
  updateStats();
  filterBooks();
  updateLastTime();
}

function normalizeTitle(t) {
  return (t || '').toLowerCase()
    .replace(/[^\w\u0600-\u06FF]/g, '')
    .substring(0, 50);
}

function sleep(ms) { 
  return new Promise(r => setTimeout(r, ms)); 
}

function updateProgress(current, total, source) {
  const pct = Math.round((current / total) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = 
    `â³ ${pct}% â€” ${source}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¹Ø±Ø¶
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLang(lang, btn) {
  currentLang = lang;
  document.querySelectorAll('.filter-btn').forEach(b => 
    b.className = 'filter-btn'
  );
  
  if (lang === 'all') btn.classList.add('active');
  else if (lang === 'ar') btn.classList.add('active-ar');
  else if (lang === 'fr') btn.classList.add('active-fr');
  else if (lang === 'en') btn.classList.add('active-en');
  
  filterBooks();
}

function filterBooks() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const topic = document.getElementById('topicSelect').value;
  const sort = document.getElementById('sortSelect').value;

  let filtered = ALL_BOOKS.filter(b => {
    if (currentLang !== 'all' && b.language !== currentLang) return false;
    
    if (topic && !b.topics.some(t => 
      t.toLowerCase().includes(topic.toLowerCase())
    )) return false;
    
    if (search) {
      const hay = (
        b.title + ' ' + 
        b.authors.join(' ') + ' ' + 
        b.publisher + ' ' +
        (b.description || '')
      ).toLowerCase();
      if (!hay.includes(search)) return false;
    }
    
    return true;
  });

  if (sort === 'title') {
    filtered.sort((a, b) => a.title.localeCompare(b.title, 'ar'));
  } else if (sort === 'pages') {
    filtered.sort((a, b) => (b.pages || 0) - (a.pages || 0));
  } else {
    filtered.sort((a, b) => 
      new Date(b.publication_date) - new Date(a.publication_date)
    );
  }

  renderBooks(filtered);
}

function renderBooks(books) {
  const grid = document.getElementById('booksGrid');

  if (!books.length) {
    grid.innerHTML = `
      <div class="no-results">
        <div class="emoji">ğŸ“š</div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
        <p style="font-size:.9em;margin-top:8px;opacity:.7">Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</p>
      </div>`;
    return;
  }

  grid.innerHTML = books.map(b => {
    const langClass = `lang-${b.language}`;
    const langLabel = 
      b.language === 'ar' ? 'Ø¹Ø±Ø¨ÙŠ' : 
      b.language === 'fr' ? 'FranÃ§ais' : 
      'English';
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¹Ø§Ø¯ÙŠØ©
    const date = b.publication_date ? 
      new Date(b.publication_date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      }) : '';

    const coverHTML = b.cover ? 
      `<img src="${b.cover}" alt="${escHtml(b.title)}" 
        onerror="this.src='https://placehold.co/150x200/1a1a1a/ffffff?text=ğŸ‡µğŸ‡¸'">` :
      `<div style="width:130px;height:180px;background:linear-gradient(135deg,#c8102e,#007a3d);
        border-radius:10px;display:flex;align-items:center;justify-content:center;
        font-size:4em;text-shadow:2px 2px 8px rgba(0,0,0,.3)">ğŸ‡µğŸ‡¸</div>`;

    const featuredTopics = ['Nakba', 'Gaza', 'Genocide', 'Occupation', 'Resistance'];
    const topicsHTML = b.topics.slice(0, 6).map(t => {
      const isFeatured = featuredTopics.some(ft => 
        t.toLowerCase().includes(ft.toLowerCase())
      );
      return `<span class="topic-tag ${isFeatured ? 'featured' : ''}">${escHtml(t)}</span>`;
    }).join('');

    return `
    <div class="book-card">
      <div class="book-cover-wrap">
        ${coverHTML}
        <span class="lang-badge ${langClass}">${langLabel}</span>
        <span class="source-badge">${escHtml(b.source)}</span>
      </div>
      <div class="book-body" dir="rtl">
        <div class="book-title">${escHtml(b.title)}</div>
        <div class="book-author">
          âœï¸ ${escHtml(b.authors.slice(0, 3).join('ØŒ ') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}
        </div>
        <div class="book-publisher">
          ğŸ¢ ${escHtml(b.publisher || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}
        </div>
        <div class="book-meta">
          ${date ? `<span>ğŸ“… ${date}</span>` : ''}
          ${b.pages ? `<span>ğŸ“„ ${b.pages} ØµÙØ­Ø©</span>` : ''}
          ${b.rating ? `<span>â­ ${b.rating.toFixed(1)}</span>` : ''}
          ${b.isbn ? `<span>ğŸ“‹ ${b.isbn.substring(0, 13)}</span>` : ''}
        </div>
        <div class="book-topics">${topicsHTML}</div>
        ${b.description ? 
          `<div class="book-desc">${escHtml(b.description)}</div>` : ''}
        <div class="book-actions">
          <a href="${escHtml(b.book_url)}" target="_blank" 
            rel="noopener noreferrer" class="btn-link btn-primary">
            ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨
          </a>
          ${b.isbn ? 
            `<a href="https://www.worldcat.org/isbn/${b.isbn}" 
              target="_blank" rel="noopener" class="btn-link btn-secondary">
              ğŸ“š WorldCat
            </a>` : ''}
        </div>
      </div>
    </div>`;
  }).join('');
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateStats() {
  document.getElementById('totalCount').textContent = ALL_BOOKS.length;
  document.getElementById('arCount').textContent = 
    ALL_BOOKS.filter(b => b.language === 'ar').length;
  document.getElementById('enCount').textContent = 
    ALL_BOOKS.filter(b => b.language === 'en').length;
  document.getElementById('frCount').textContent = 
    ALL_BOOKS.filter(b => b.language === 'fr').length;
  
  const publishers = new Set(
    ALL_BOOKS.map(b => b.publisher).filter(Boolean)
  );
  document.getElementById('publisherCount').textContent = publishers.size;
  
  const years = ALL_BOOKS
    .map(b => new Date(b.publication_date).getFullYear())
    .filter(y => y && y > 2020);
  if (years.length) {
    const minYear = Math.min(...years);
    const maxYear = Math.max(...years);
    document.getElementById('yearSpan').textContent = 
      minYear === maxYear ? maxYear : `${minYear}-${maxYear}`;
  }
}

function updateLastTime() {
  document.getElementById('lastUpdate').textContent = 
    'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + new Date().toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ø±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSources() {
  const el = document.getElementById('sourcesList');
  el.classList.toggle('open');
  if (el.classList.contains('open') && !el.innerHTML) {
    el.innerHTML = SOURCES_LIST
      .map((s, i) => `${i + 1}. ${s}`)
      .join('<br>');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function manualRefresh() {
  localStorage.removeItem('palestine_books_v3');
  fetchAllBooks();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(async function init() {
  try {
    const cache = JSON.parse(
      localStorage.getItem('palestine_books_v3')
    );
    
    if (cache && (Date.now() - cache.timestamp) < 3600000) {
      ALL_BOOKS = cache.books;
      updateStats();
      filterBooks();
      updateLastTime();
      
      console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒØ§Ø´:', ALL_BOOKS.length, 'ÙƒØªØ§Ø¨');
      
      const remaining = 3600000 - (Date.now() - cache.timestamp);
      setTimeout(() => fetchAllBooks(), remaining);
      return;
    }
  } catch(e) {}

  await fetchAllBooks();
})();

setInterval(() => {
  console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ...');
  fetchAllBooks();
}, 3600000);
</script>

</body>
</html>
